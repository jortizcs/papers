\section{API Overview}

In this section we give an overview of the application programming interface.  We give a description of some of the main
function calls and the corresponding RESTful interface version.  We also provide a full tutorial 
of the HTTP/REST interface in Appendex~\ref{appendix:tutorial}.

\begin{table}[h]
\begin{center}
\begin{tabular}{| r | l |}
	\hline
	\textbf{function} & \textbf{description} \\ \hline
	create & Create a file. Overlaps with several other calls.    \\ \hline

	delete & Delete a file. \\ hline

	register & Join as data source.    \\ \hline

	push & Write to associated stream file.  \\ \hline

	label & Add an attribute-value pair.  \\ \hline

	rlabel & Remove an attribute-value pair.  \\ \hline
\end{tabular}
\caption{Overview of StreamFS file-related API calls.  Library written in Java, PHP, and C.}
\label{tab:api_calls1}
\end{center}
\end{table}

Table~\ref{tab:api_calls1} gives and overview of API calls that are available through the standard library, available in several
languages.  It provides functions for creating and deleting files as well as decorating them with attribute-value pairs.
The Energy Lens application makes extensive use of this library interface for dealing with consistency-management
features and ``atomic'' update operations.  Most of the applications that runs on the phone, however, uses the HTTP/REST
interface.


\begin{table}[h]
\begin{center}
\begin{tabular}{| r | l |}
	\hline
	\textbf{callback} & \textbf{description} \\ \hline
	search & General search of terms through file name and content.  Similar to grep.    \\ \hline

	filter & Informs device of removal.    \\ \hline

	query & Timeseries query.    \\ \hline

\end{tabular}
\caption{Summary of control interface callbacks in StreamFS.  Library written in Java, PHP, and C.}
\label{tab:api_calls2}
\end{center}
\end{table}

The search API is simple (summarized in Table~\ref{tab:api_calls2}.  It includes three main calls, depending 
on what you are searching for.  If you the application 
which to make a general search query based on the name of the file, the \texttt{search} call allows you to specify 
a set of terms to look for or to specify specific attribute-value pairs.  It also provides a general 
\texttt{path} search option where you can specify that the path match a regular expression.
The filter call can be combined with the search call to filter on metadata values returned from the \texttt{path} search.
Finally, the \texttt{query} call runs a timeseries query on a specified path or all stream files
that match a regular expression specified by through the \texttt{path} option.

Finally, the pub/sub library is used extensively throughout all our applications.  It is specifically used in 
the Energy Lens for initiating the aggregation processing.  Table~\ref{tab:api_calls3} summarizes
the two main API calls for dealing with subscriptions and pipes.


\begin{table}[h]
\begin{center}
\begin{tabular}{| r | l |}
	\hline
	\textbf{callback} & \textbf{description} \\ \hline
	pipe & Pipes the list of specified streams to \\
		 & either an active process or a process \\
		 & definition file.    \\ \hline

	subscribe & Create an subscription from a 		 \\
			  & set of streams to an external target \\
			  & through a callback function. 		 \\ \hline

\end{tabular}
\caption{Summary of control interface callbacks in StreamFS.  Library written in Java, PHP, and C.}
\label{tab:api_calls3}
\end{center}
\end{table}

Internally the mechanism for dealing with either is similar, however, the semantics of the two calls implies that
pipes direct streams to user-defined internal/external processing elements, while subscriptions are
for external sinks running on the client.  Subscriptions are managed through an \texttt{HTTP POST}
operation.  If the user is using a client stub, the \texttt{POST} is unmarshalled and a callback
is triggered with the body of the \texttt{POST} submission.

% \begin{table}[h]
% \begin{center}
% \begin{tabular}{| r | l |}
% 	\hline
% 	\textbf{callback} & \textbf{description} \\ \hline
% 	ctrlRcv & Function that handles the reception of control data.    \\ \hline

% 	remove & Informs device of removal.    \\ \hline

% 	suspend & Tells device to stop sending data.  \\ \hline

% 	resume & Tells device to resume sending data.  \\ \hline
% \end{tabular}
% \caption{Summary of control interface callbacks in StreamFS.  Library written in Java, PHP, and C.}
% \label{tab:api_calls2}
% \end{center}
% \end{table}

% Full RESTful tutorial is in the Appendix, 